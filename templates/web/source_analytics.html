<!DOCTYPE html>
<html>
  <head>
<!--
   Author: cf AUTHORS.txt 
   License:  Copyright (c) 2010-2012 Massachusetts Institute of Technology.
   MIT License (cf. MIT-LICENSE.txt or http://www.opensource.org/licenses/mit-license.php)
  -->
    <title>NB Analytics</title>
    <link type="text/css" href="/content/compiled/docanalytics.css" rel="stylesheet" />
    <script type="text/javascript" src="/content/compiled/docanalytics_NB.js"></script>
        <script type="text/template" id="page-template">
          <div class="page-wrap">
            <img class="page-img" src="<%= img_url %>">
            <span class="page-num"><%= page %></span>
            <div class="page-stats">
              <%= num_annotations %> annotations
              <br/><%= num_questions %> questions
            </div>
            <div class="clearfix"></div>
          </div>
    </script>
    <script>
      var PageView = Backbone.View.extend({
        initialize: function(){
          this.render();
        },

        el: "#pages-container",

        template: _.template(jQuery("#page-template").html()),

        render: function(){
          // console.log(this.template(this.model.attributes));
          jQuery(this.el).append(this.template(this.model.attributes));
          return this;
        }
      });
    </script>
    <script>
      (function($){
        $(document).ready(function() {
            var pages = {{ pages|safe }};
            var img_server = "http://localhost:8000";
            var doc = new Document();
            var page;
            for (var i=1; i <= {{ numpages }}; i++) {
              if (i in pages) {
                page = new Page(pages[i]);  
              } else {
                page = new Page({'page': i});
              }
              // TODO: don't hardcode the doc ID or concierge key
              var img_url = img_server + "/pdf/cache2/288/33/8?ckey=Yl1vV4ddJ43qsAN8e0bgSmRE4nI4UaD5&amp;page=" + i;
              page.set('img_url', img_url);
              var page_view = new PageView({ model: page });
              doc.add(page);
            }
        });
      })(jQuery);
    </script>

  </head>
  <body>
    THIS IS THE ANALYTICS PAGE

    <div id="pages-container"></div>


  </body>
</html>
